<div class="echos-breadcrumb" fxLayout="row" fxLayoutWrap="wrap" fxLayoutAlign="start center">
  <div routerLink="/" fxFlexAlign="start"><mat-icon>home</mat-icon></div>
  <div routerLink="/etablissement/liste" fxFlexAlign="start">Liste des établissements</div>
  <div fxFlexAlign="start">Fiche établissement</div>
</div>

<div fxLayout="row" fxLayoutAlign="start center">
  <h1 fxFlex>
    Fiche établissement<span class="titleItem">{{item.name}}</span>
  </h1>
  <button *ngIf="authService.isSuperAgent()" mat-fab color="primary" [routerLink]="['/etablissement', item.id, 'editer']"><mat-icon>edit</mat-icon></button>
</div>

<div class="echos-title">Informations</div>

<div class="echos-infos">

  <div fxLayout="row">
    <label>Type:</label>
    <div fxFlexOffset="10px">{{getTypeLabel()}}</div>
  </div>

  <div fxLayout="row">
    <label>Statut:</label>
    <div fxFlexOffset="10px">{{getStatusLabel()}}</div> </div>

  <div *ngIf="item.address" fxLayout="row">
    <label>Adresse:</label>
    <div fxFlexOffset="10px">{{item.address}}</div>
  </div>

  <div *ngIf="item.postalcode" fxLayout="row">
    <label>Code postal:</label>
    <div fxFlexOffset="10px">{{item.postalcode}}</div>
  </div>

  <div *ngIf="item.city" fxLayout="row">
    <label>Ville:</label>
    <div fxFlexOffset="10px">{{item.city}}</div>
  </div>

  <div *ngIf="item.phone" fxLayout="row">
    <label>Numéro de téléphone:</label>
    <div fxFlexOffset="10px">{{item.phone}}</div>
  </div>

  <div *ngIf="item.mail" fxLayout="row">
    <label>Adresse mail:</label>
    <div fxFlexOffset="10px"><a href="mailto:{{item.mail}}" title="email">{{item.mail}}</a></div>
  </div>
</div>

<div class="echos-title" fxLayout="row" style="margin-top: 80px">
  <div fxFlex>Liste des audits</div>
  <button *ngIf="authService.isSuperAgent()" mat-raised-button [routerLink]="['/audit/creer', item.id]">Démarrer un audit<mat-icon>add</mat-icon></button>
</div>

<div *ngIf="!item.audits || !item.audits.length" class="echos-warning">Aucun audit trouvé.</div>

<mat-toolbar *ngIf="item.audits && item.audits.length" style="margin: 20px 0 0 0">
  <button mat-raised-button style="margin: 0 auto" (click)="createLabelingFile()" [disabled]="labelingFileToCreate.audits.length < 1" color='primary'>Générer le dossier de labelisation</button>
</mat-toolbar>

<mat-list>
  <mat-list-item class="echos-list-item" *ngFor="let audit of item.audits">
    <div mat-line fxLayout="row" fxLayoutAlign="start center">
      <mat-checkbox [attr.disabled]="labelingFileToCreate.audits.length == 2 && labelingFileToCreate.audits.indexOf(audit.id) == -1" (change)="toggleInLabelingFile(audit.id, 'audits')" fxFlex="50px"></mat-checkbox>
      <div fxFlex class="have-childs" fxFill>
        <div>
          <div>{{audit.inquiryform?.title}} - {{audit.date_start | date:'dd/MM/yyyy à HH:mm'}}</div>
        </div>
        <div *ngIf="!audit.active">Terminé</div>
        <div *ngIf="audit.active" style="color: rgb(96, 190, 64)">En cours</div>
      </div>
      <div fxLayout="column" fxLayoutAlign="space-around center">
        <div class="echos-percent echos-percent-complete" title="complété">{{audit.cached_percent_complete * 100 | number:'1.0-0' }} %</div>
        <div class="echos-percent echos-percent-ignored" title="ignoré">{{audit.cached_percent_ignored * 100 | number:'1.0-0' }} %</div>
      </div>
      <button mat-button *ngIf="audit.active || authService.isSuperAgent()" [routerLink]="['/audit', audit.key]"><mat-icon color="primary">chevron_right</mat-icon></button>
    </div>
  </mat-list-item>
</mat-list>

<div class="echos-title" fxLayout="row" style="margin-top: 80px">
  <div fxFlex>Liste des "recap actions"</div>
  <button *ngIf="authService.isSuperAgent()" mat-raised-button [routerLink]="['/recap_actions/creer', item.id]">Démarrer un "récap actions"<mat-icon>add</mat-icon></button>
</div>

<div *ngIf="!item.recap_actions || !item.recap_actions.length" class="echos-warning">Aucun "recap actions" trouvé.</div>

<mat-list>
  <mat-list-item class="echos-list-item" *ngFor="let recap_action of item.recap_actions">
    <div mat-line fxLayout="row" fxLayoutAlign="start center">
      <mat-checkbox [attr.disabled]="labelingFileToCreate.recap_actions.length == 2 && labelingFileToCreate.recap_actions.indexOf(recap_action.id) == -1" (change)="toggleInLabelingFile(recap_action.id, 'recap_actions')" fxFlex="50px"></mat-checkbox>
      <div fxFlex class="have-childs" fxFill>
        <div>
          <div>{{recap_action.inquiryform?.title}} - {{recap_action.date_start | date:'dd/MM/yyyy à HH:mm'}}</div>
        </div>
        <div *ngIf="!recap_action.active">Terminé</div>
        <div *ngIf="recap_action.active" style="color: rgb(96, 190, 64)">En cours</div>
      </div>
      <div fxLayout="column" fxLayoutAlign="space-around center">
        <div class="echos-percent echos-percent-complete" title="complété">{{recap_action.cached_percent_complete * 100 | number:'1.0-0' }} %</div>
        <div class="echos-percent echos-percent-ignored" title="ignoré">{{recap_action.cached_percent_ignored * 100 | number:'1.0-0' }} %</div>
      </div>
      <button mat-button *ngIf="recap_action.active || authService.isSuperAgent()" [routerLink]="['/recap_actions', recap_action.id]"><mat-icon color="primary">chevron_right</mat-icon></button>
    </div>
  </mat-list-item>
</mat-list>


<div class="help">
  Pour générer un dossier de labélisation, cliquez sur le bouton "Générer le dossier de labelisation"
</div>

<div class="echos-title" fxLayout="row" style="margin-top: 80px">
  <div fxFlex>Liste des "dossiers de labélisation"</div>
</div>

<div *ngIf="!item.labeling_files || !item.labeling_files.length" class="echos-warning">Aucun dossier de labelisation trouvé.</div>

<mat-list>
  <mat-list-item class="echos-list-item" *ngFor="let labeling_file of item.labeling_files" [routerLink]="['/dossier_de_labelisation', labeling_file.id]">
    <div mat-line fxLayout="row" fxLayoutAlign="start center">
      <div fxFlex class="have-childs" fxFill>
        <div>
          <div>Dossier de labélisation crée le {{labeling_file.createdAt | date:'dd/MM/yyyy à HH:mm'}}</div>
        </div>
        <div *ngIf="!labeling_file.active">Terminé</div>
        <div *ngIf="labeling_file.active" style="color: rgb(96, 190, 64)">En cours</div>
      </div>
      <button mat-button *ngIf="labeling_file.active || authService.isSuperAgent()"><mat-icon color="primary">chevron_right</mat-icon></button>
    </div>
  </mat-list-item>
</mat-list>

<mat-toolbar *ngIf="item.audits && item.audits.length" style="margin-top: 30px;text-align: center">
  <button mat-raised-button style="margin: 0 auto" (click)="createLabelingFile()" [disabled]="labelingFileToCreate.audits.length < 1" color="primary">Générer le dossier de labellisation</button>
</mat-toolbar>

<div class="echos-breadcrumb" fxLayout="row" fxLayoutWrap="wrap" fxLayoutAlign="start center">
  <div routerLink="/" fxFlexAlign="start"><mat-icon>home</mat-icon></div>
  <div [routerLink]="['/etablissement', infos.audit.establishment.id]" fxFlexAlign="start">{{infos.audit.establishment.name}}</div>
  <div fxFlexAlign="start">Compléter un audit</div>
</div>

<div fxLayout="row" fxLayoutAlign="start center">
  <h1 fxFlex>
    Audit de {{infos.audit.establishment.name}}
  </h1>
  <button *ngIf="authService.isSuperAgent()" mat-fab color="primary" [routerLink]="['/audit', infos.audit.id, 'editer']"><mat-icon>edit</mat-icon></button>
  <button *ngIf="authService.isSuperAgent()" mat-fab color="primary" [routerLink]="['/audit', infos.audit.id, 'rapport']" fxFlexOffset="35px"><mat-icon>assessment</mat-icon></button>
</div>

<div class="echos-answer-breadcrumb">
  <div *ngIf="node" fxLayout="row" fxLayoutAlign="start center">
    <div (click)="goToRoot()" class="rootNode">Liste des thèmes</div>
    <div *ngFor="let pn of parentNodes; let i = index">
      <div *ngIf="pn.title" class="parentNode" (click)="goToParent(i)">{{pn.title}}</div>
    </div>
    <div *ngIf="node.title" class="currentNode" fxFlex>{{node.title}}</div>
  </div>
</div>

<div fxLayout="row" fxLayoutAlign="start center" class="search-container">
  <mat-form-field fxFlex>
    <input matInput #search [(value)]="searchTerm" type="search" placeholder="Recherche" fxFlex (keyup)="filterList(search.value)">
  </mat-form-field>
</div>

<mat-toolbar fxLayout="row" fxLayoutAlign="end center" *ngIf="parentNodes.length">
  <button fxFlexOffset="45px" mat-button (click)="goToParent()">Remonter d'un niveau</button>
</mat-toolbar>

<mat-list *ngIf="!node.type || !node.id_node_parent">
  <mat-list-item class="echos-list-item" *ngFor="let childItem of filteredChildList" [ngClass]="{hide: !childItem.selected && hideUnselected}" (click)="goToChild(childItem.id_node)">
    <div mat-line fxLayout="row" fxLayoutAlign="start center">
      <div *ngIf="childItem.color" class="echos-color" [ngStyle]="{'background-color': '#'+childItem.color}"></div>
      <div fxFlex fxFlexOffset="20px">
        <div fxLayout="column" fxLayoutAlign="start center" class="have-childs">
          <div fxFlex fxFlexAlign="start">{{childItem.title}}</div>
          <div fxFlexAlign="start" *ngIf="childItem.description">{{childItem.description}}</div>
        </div>
      </div>
      <div class="echos-percent">{{childItem.progress}} %</div>
      <button mat-button color="primary"><mat-icon>chevron_right</mat-icon></button>
    </div>
  </mat-list-item>
</mat-list>

<div *ngIf="node.type && node.id_node_parent" class="echos-question-list">
  <div *ngFor="let childItem of filteredChildList" [ngClass]="{hide: !childItem.selected && hideUnselected}">
    <div class="echos-question-list-item">
      <answer-edit style="flex-direction: column" [node]="childItem" [audit]="infos.audit"></answer-edit>
    </div>
  </div>
</div>

<!-- <div *ngIf="node.type && node.id_node_parent">
  <h1>À toi Nico !</h1>

  {{this.node | json}}
</div> -->

<mat-toolbar fxLayout="row" fxLayoutAlign="end center">
  <button fxFlexOffset="45px" *ngIf="parentNodes.length" mat-button (click)="goToParent()">Remonter d'un niveau</button>
</mat-toolbar>

<div *ngIf="showSaveButton" fxLayout="row" fxLayoutAlign="center center" style="margin-top: 30px">
  <button mat-raised-button color="primary" (click)="save()">Enregistrer le questionnaire</button>
</div>
